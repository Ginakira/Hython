# 海贼 Hython 语言设计与开发

## 项目描述

海贼 19-8 班 C++ 综合项目，设计一门自己的编程语言

## 代码的一生

程序的源代码本质上就是一个文本文件。

Python 程序运行的过程，实际上是将源代码这个文本文件，通过 python 解释器，解释成相应的功能逻辑，运行出相关的效果。接下来我们要完成的，就是一个类似 Python 的解释器。

将源码转化为抽象语法树（AST），然后通过遍历来模拟程序的运行过程。

## Antlr 基础使用

Antlr 是一款词法、语法分析器，负责将源代码转化为抽象语法树。

EBNF 文法

jar 包生成的文件就是帮助转化抽象语法树的

教程中的 main.cpp 就是解释器

在文法文件中含有输出结构信息（tree ...）的语句 通过 jar 嵌入到生成的 c 中

1. 增加除法表达式的支持（增加文本【源代码】中的关键字）
2. 增加取余表达式的支持（增加文本【源代码】中的关键字）
3. 修改解释器，对于每一行内容，都输出其表达式的值（修改解释器的功能）
4. 增加变量定义的语法结构
5. 增加作用域的功能（增加文本【源代码】中的关键字-大括号）
   目前的声明和使用并没有分开，如果不分开会导致子作用域中同名变量情况下的冲突，所以应该先完成 4
   1. 作用域有严格的先后顺序，先在子作用域中查找，再去父作用域中查找，所以应该使用链表来实现
   2. 增加 next 指针和对应的构造函数

## 简单的流程控制

1. 整理工程目录，include/lib/bin/src...

2. 整理 main.cpp 内容，分成头文件和源文件，main.cpp 尽量简单

3. print 子句

4. 条件表达式(==,<=,>=,&&,||)

5. if 结构的增加

6. for 结构的增加

7. while 结构的增加

8. do...while 结构的增加

9. 找出存在的BUG`IMPORTANT`

    1. for循环的实现是不正确的，导致初始化语句中定义的变量在for作用域结束后仍能访问

    2. 所以应当新声明一个作用域，在新的作用域内执行，故应当改成：

        ```cpp
        case FOR: {
            ExprTreeEvaluator new_this(this);
            for (new_this.run(tree[0]); new_this.run(tree[1]);
                 new_this.run(tree[2])) {
                new_this.run(tree[3]);
            }
            return 0;
        } break;
        ```

        

## 增加弱类型系统

1. 用责任链模式改写整体ExprTreeEvaluator类的功能
2. 增加了责任链的单例模式 MasterChainSingle类
3. 增加了Master功能类
4. 增加了Parameter作用域类
5. `找到程序中的bug`
6. 设计并实现弱类型系统